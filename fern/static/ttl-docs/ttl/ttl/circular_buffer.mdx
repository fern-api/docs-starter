---
layout: overview
slug: ttl/ttl/circular_buffer
title: ttl.circular_buffer
---

Circular buffer operations for inter-thread communication.

## Module Contents

### Classes

| Name | Description |
|------|-------------|
| [`CircularBuffer`](#ttl-circular_buffer-CircularBuffer) | Circular buffer for inter-thread communication. |

### Functions

| Name | Description |
|------|-------------|
| [`_get_cb_tensor_type`](#ttl-circular_buffer-_get_cb_tensor_type) | Extract the tensor type from a TTL CB type. |
| [`_next_cb_index`](#ttl-circular_buffer-_next_cb_index) | Get next CB index and increment counter. |
| [`_reset_cb_counter`](#ttl-circular_buffer-_reset_cb_counter) | Reset the CB index counter. Called at kernel start. |
| [`get_cb_count`](#ttl-circular_buffer-get_cb_count) | Return number of CBs allocated so far. |
| [`make_circular_buffer_like`](#ttl-circular_buffer-make_circular_buffer_like) | Create a circular buffer with properties derived from a tensor. |

### Data

[`_cb_index_counter`](#ttl-circular_buffer-_cb_index_counter)

### API

<Anchor id="ttl-circular_buffer-CircularBuffer">

<CodeBlock showLineNumbers={false} wordWrap={true}>

```python
class ttl.circular_buffer.CircularBuffer(
    tensor: typing.Any,
    shape: typing.Tuple[int, int],
    buffer_factor: int
)
```

</CodeBlock>
</Anchor>

<Indent>

Circular buffer for inter-thread communication.

Circular buffers provide producer-consumer synchronization between
compute and data movement threads.

Can be instantiated via make_circular_buffer_like() in kernel body,
then captured by thread closures. Methods generate TTL ops during compilation.


<ParamField path="_cb_index" type="= _next_cb_index()">
</ParamField>
<Anchor id="ttl-circular_buffer-CircularBuffer-pop">

<CodeBlock links={{"ttl.circular_buffer.CircularBuffer":"#ttl-circular_buffer-CircularBuffer"}} showLineNumbers={false} wordWrap={true}>

```python
ttl.circular_buffer.CircularBuffer.pop(
    ast_self: ttl.circular_buffer.CircularBuffer
) -> None
```

</CodeBlock>
</Anchor>

<Indent>

Signal that data has been consumed (consumer release).

Use in consumer threads after wait() to signal that data has been
consumed and space is available for producers.


</Indent>
<Anchor id="ttl-circular_buffer-CircularBuffer-push">

<CodeBlock links={{"ttl.circular_buffer.CircularBuffer":"#ttl-circular_buffer-CircularBuffer"}} showLineNumbers={false} wordWrap={true}>

```python
ttl.circular_buffer.CircularBuffer.push(
    ast_self: ttl.circular_buffer.CircularBuffer
) -> None
```

</CodeBlock>
</Anchor>

<Indent>

Signal that data is ready in the circular buffer (producer release).

Use in producer threads after reserve() to signal that data has been
written and is ready for consumers.


</Indent>
<Anchor id="ttl-circular_buffer-CircularBuffer-reserve">

<CodeBlock links={{"ttl.circular_buffer.CircularBuffer":"#ttl-circular_buffer-CircularBuffer","ttl.ttl_api.TensorBlock":"/ttl/ttl/operators#ttl-operators-TensorBlock"}} showLineNumbers={false} wordWrap={true}>

```python
ttl.circular_buffer.CircularBuffer.reserve(
    ast_self: ttl.circular_buffer.CircularBuffer
) -> ttl.ttl_api.TensorBlock
```

</CodeBlock>
</Anchor>

<Indent>

Reserve space in the circular buffer (producer acquire).

Use in producer threads to acquire space for writing. Must be followed
by push() to signal data is ready.

**Returns:** `TensorBlock`

The reserved space with CB association.


</Indent>
<Anchor id="ttl-circular_buffer-CircularBuffer-wait">

<CodeBlock links={{"ttl.circular_buffer.CircularBuffer":"#ttl-circular_buffer-CircularBuffer","ttl.ttl_api.TensorBlock":"/ttl/ttl/operators#ttl-operators-TensorBlock"}} showLineNumbers={false} wordWrap={true}>

```python
ttl.circular_buffer.CircularBuffer.wait(
    ast_self: ttl.circular_buffer.CircularBuffer
) -> ttl.ttl_api.TensorBlock
```

</CodeBlock>
</Anchor>

<Indent>

Wait for data from the circular buffer (consumer acquire).

Use in consumer threads to acquire data. Must be followed by pop()
to signal consumption is complete.

**Returns:** `TensorBlock`

The acquired data with CB association.


</Indent>
</Indent>

<Anchor id="ttl-circular_buffer-_get_cb_tensor_type">

<CodeBlock showLineNumbers={false} wordWrap={true}>

```python
ttl.circular_buffer._get_cb_tensor_type(
    cb_val
)
```

</CodeBlock>
</Anchor>

<Indent>

Extract the tensor type from a TTL CB type.


</Indent>

<Anchor id="ttl-circular_buffer-_next_cb_index">

<CodeBlock showLineNumbers={false} wordWrap={true}>

```python
ttl.circular_buffer._next_cb_index()
```

</CodeBlock>
</Anchor>

<Indent>

Get next CB index and increment counter.


</Indent>

<Anchor id="ttl-circular_buffer-_reset_cb_counter">

<CodeBlock showLineNumbers={false} wordWrap={true}>

```python
ttl.circular_buffer._reset_cb_counter()
```

</CodeBlock>
</Anchor>

<Indent>

Reset the CB index counter. Called at kernel start.


</Indent>

<Anchor id="ttl-circular_buffer-get_cb_count">

<CodeBlock showLineNumbers={false} wordWrap={true}>

```python
ttl.circular_buffer.get_cb_count()
```

</CodeBlock>
</Anchor>

<Indent>

Return number of CBs allocated so far.


</Indent>

<Anchor id="ttl-circular_buffer-make_circular_buffer_like">

<CodeBlock links={{"ttl.circular_buffer.CircularBuffer":"#ttl-circular_buffer-CircularBuffer"}} showLineNumbers={false} wordWrap={true}>

```python
ttl.circular_buffer.make_circular_buffer_like(
    tensor: typing.Any,
    shape: typing.Tuple[int, int],
    buffer_factor: int = 2
) -> ttl.circular_buffer.CircularBuffer
```

</CodeBlock>
</Anchor>

<Indent>

Create a circular buffer with properties derived from a tensor.

**Parameters:**

<ParamField path="tensor" type="Any">
Tensor that determines the CB's data type
</ParamField>

<ParamField path="shape" type="Tuple[int, int]">
(rows, cols) in tiles for wait/reserve operations
</ParamField>

<ParamField path="buffer_factor" type="int" default="2">
Capacity multiplier (default 2 for double-buffering)
</ParamField>

**Returns:** `CircularBuffer`

CircularBuffer for use in thread function closures


</Indent>

<Anchor id="ttl-circular_buffer-_cb_index_counter">

<CodeBlock showLineNumbers={false} wordWrap={true}>

```python
ttl.circular_buffer._cb_index_counter = 0
```

</CodeBlock>
</Anchor>

