---
layout: overview
slug: nemo-rl/nemo_rl/data/processors
title: nemo_rl.data.processors
---

Contains data processors for evaluation.

## Module Contents

### Functions

| Name | Description |
|------|-------------|
| [`_construct_multichoice_prompt`](#nemo_rl-data-processors-_construct_multichoice_prompt) | Construct prompt from question and options. |
| [`helpsteer3_data_processor`](#nemo_rl-data-processors-helpsteer3_data_processor) | Process a HelpSteer3 preference datum into a DatumSpec for GRPO training. |
| [`math_data_processor`](#nemo_rl-data-processors-math_data_processor) | Process a datum dictionary (directly loaded from dataset) into a DatumSpec for the Math Environment. |
| [`math_hf_data_processor`](#nemo_rl-data-processors-math_hf_data_processor) | Process a datum dictionary (directly loaded from data/hf_datasets/openmathinstruct2.py) into a DatumSpec for the Reward Model Environment. |
| [`multichoice_qa_processor`](#nemo_rl-data-processors-multichoice_qa_processor) | Process a datum dictionary (directly loaded from dataset) into a DatumSpec for multiple-choice problems. |
| [`nemo_gym_data_processor`](#nemo_rl-data-processors-nemo_gym_data_processor) | Process a datum dictionary (directly loaded from dataset) into a DatumSpec for Nemo Gym. |
| [`preference_preprocessor`](#nemo_rl-data-processors-preference_preprocessor) | Process a datum dictionary for RM/DPO training. |
| [`register_processor`](#nemo_rl-data-processors-register_processor) | - |
| [`sft_processor`](#nemo_rl-data-processors-sft_processor) | Process a datum dictionary for SFT training. |
| [`vlm_hf_data_processor`](#nemo_rl-data-processors-vlm_hf_data_processor) | Process a datum dictionary (directly loaded from response_datasets/&lt;dataset_name&gt;.py) into a DatumSpec for the VLM Environment. |

### Data

[`PROCESSOR_REGISTRY`](#nemo_rl-data-processors-PROCESSOR_REGISTRY)

[`TokenizerType`](#nemo_rl-data-processors-TokenizerType)

### API

<Anchor id="nemo_rl-data-processors-_construct_multichoice_prompt">

<CodeBlock showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.data.processors._construct_multichoice_prompt(
    prompt: str,
    question: str,
    options: dict[str, str]
) -> str
```

</CodeBlock>
</Anchor>

<Indent>

Construct prompt from question and options.


</Indent>

<Anchor id="nemo_rl-data-processors-helpsteer3_data_processor">

<CodeBlock links={{"nemo_rl.data.interfaces.TaskDataSpec":"/nemo-rl/nemo_rl/data/interfaces#nemo_rl-data-interfaces-TaskDataSpec","nemo_rl.data.processors.TokenizerType":"#nemo_rl-data-processors-TokenizerType","nemo_rl.data.interfaces.DatumSpec":"/nemo-rl/nemo_rl/data/interfaces#nemo_rl-data-interfaces-DatumSpec"}} showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.data.processors.helpsteer3_data_processor(
    datum_dict: dict[str, typing.Any],
    task_data_spec: nemo_rl.data.interfaces.TaskDataSpec,
    tokenizer: nemo_rl.data.processors.TokenizerType,
    max_seq_length: int,
    idx: int
) -> nemo_rl.data.interfaces.DatumSpec
```

</CodeBlock>
</Anchor>

<Indent>

Process a HelpSteer3 preference datum into a DatumSpec for GRPO training.

This function converts HelpSteer3 preference data to work with GRPO by:
1. Using the context as the prompt
2. Using the preferred completion as the target response
3. Creating a reward signal based on preference scores


</Indent>

<Anchor id="nemo_rl-data-processors-math_data_processor">

<CodeBlock links={{"nemo_rl.data.interfaces.TaskDataSpec":"/nemo-rl/nemo_rl/data/interfaces#nemo_rl-data-interfaces-TaskDataSpec","nemo_rl.data.processors.TokenizerType":"#nemo_rl-data-processors-TokenizerType","nemo_rl.data.interfaces.DatumSpec":"/nemo-rl/nemo_rl/data/interfaces#nemo_rl-data-interfaces-DatumSpec"}} showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.data.processors.math_data_processor(
    datum_dict: dict[str, typing.Any],
    task_data_spec: nemo_rl.data.interfaces.TaskDataSpec,
    tokenizer: nemo_rl.data.processors.TokenizerType,
    max_seq_length: int,
    idx: int
) -> nemo_rl.data.interfaces.DatumSpec
```

</CodeBlock>
</Anchor>

<Indent>

Process a datum dictionary (directly loaded from dataset) into a DatumSpec for the Math Environment.


</Indent>

<Anchor id="nemo_rl-data-processors-math_hf_data_processor">

<CodeBlock links={{"nemo_rl.data.interfaces.TaskDataSpec":"/nemo-rl/nemo_rl/data/interfaces#nemo_rl-data-interfaces-TaskDataSpec","nemo_rl.data.processors.TokenizerType":"#nemo_rl-data-processors-TokenizerType","nemo_rl.data.interfaces.DatumSpec":"/nemo-rl/nemo_rl/data/interfaces#nemo_rl-data-interfaces-DatumSpec"}} showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.data.processors.math_hf_data_processor(
    datum_dict: dict[str, typing.Any],
    task_data_spec: nemo_rl.data.interfaces.TaskDataSpec,
    tokenizer: nemo_rl.data.processors.TokenizerType,
    max_seq_length: int,
    idx: int
) -> nemo_rl.data.interfaces.DatumSpec
```

</CodeBlock>
</Anchor>

<Indent>

Process a datum dictionary (directly loaded from data/hf_datasets/openmathinstruct2.py) into a DatumSpec for the Reward Model Environment.


</Indent>

<Anchor id="nemo_rl-data-processors-multichoice_qa_processor">

<CodeBlock links={{"nemo_rl.data.interfaces.TaskDataSpec":"/nemo-rl/nemo_rl/data/interfaces#nemo_rl-data-interfaces-TaskDataSpec","nemo_rl.data.processors.TokenizerType":"#nemo_rl-data-processors-TokenizerType","nemo_rl.data.interfaces.DatumSpec":"/nemo-rl/nemo_rl/data/interfaces#nemo_rl-data-interfaces-DatumSpec"}} showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.data.processors.multichoice_qa_processor(
    datum_dict: dict[str, typing.Any],
    task_data_spec: nemo_rl.data.interfaces.TaskDataSpec,
    tokenizer: nemo_rl.data.processors.TokenizerType,
    max_seq_length: int,
    idx: int
) -> nemo_rl.data.interfaces.DatumSpec
```

</CodeBlock>
</Anchor>

<Indent>

Process a datum dictionary (directly loaded from dataset) into a DatumSpec for multiple-choice problems.


</Indent>

<Anchor id="nemo_rl-data-processors-nemo_gym_data_processor">

<CodeBlock links={{"nemo_rl.data.interfaces.TaskDataSpec":"/nemo-rl/nemo_rl/data/interfaces#nemo_rl-data-interfaces-TaskDataSpec","nemo_rl.data.processors.TokenizerType":"#nemo_rl-data-processors-TokenizerType","nemo_rl.data.interfaces.DatumSpec":"/nemo-rl/nemo_rl/data/interfaces#nemo_rl-data-interfaces-DatumSpec"}} showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.data.processors.nemo_gym_data_processor(
    datum_dict: dict[str, typing.Any],
    task_data_spec: nemo_rl.data.interfaces.TaskDataSpec,
    tokenizer: nemo_rl.data.processors.TokenizerType,
    max_seq_length: int | None,
    idx: int
) -> nemo_rl.data.interfaces.DatumSpec
```

</CodeBlock>
</Anchor>

<Indent>

Process a datum dictionary (directly loaded from dataset) into a DatumSpec for Nemo Gym.


</Indent>

<Anchor id="nemo_rl-data-processors-preference_preprocessor">

<CodeBlock links={{"nemo_rl.data.interfaces.TaskDataSpec":"/nemo-rl/nemo_rl/data/interfaces#nemo_rl-data-interfaces-TaskDataSpec","nemo_rl.data.interfaces.PreferenceDatumSpec":"/nemo-rl/nemo_rl/data/interfaces#nemo_rl-data-interfaces-PreferenceDatumSpec"}} showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.data.processors.preference_preprocessor(
    datum_dict: dict[str, typing.Any],
    task_data_spec: nemo_rl.data.interfaces.TaskDataSpec,
    tokenizer,
    max_seq_length: int,
    idx: int
) -> nemo_rl.data.interfaces.PreferenceDatumSpec
```

</CodeBlock>
</Anchor>

<Indent>

Process a datum dictionary for RM/DPO training.

**Examples:**

<CodeBlock showLineNumbers={false}>

```python
>>> from transformers import AutoTokenizer
>>> from nemo_rl.data.interfaces import TaskDataSpec
>>> from nemo_rl.data.processors import preference_preprocessor
>>>
>>> # Initialize tokenizer and task spec
>>> tokenizer = AutoTokenizer.from_pretrained("meta-llama/Llama-3.2-1B-Instruct")
>>> ## set a passthrough chat template for simplicity
>>> tokenizer.chat_template = "{% for message in messages %}{{ message['content'] }}{% endfor %}"
>>> task_spec = TaskDataSpec(task_name="test_preference")
>>>
>>> datum = {
...     "context": [{"role": "user", "content": "What is 2+2?"}],
...     "completions": [
...         {"rank": 0, "completion": [{"role": "assistant", "content": "4"}]},
...         {"rank": 1, "completion": [{"role": "assistant", "content": "5"}]}
...     ]
... }
>>>
>>> processed = preference_preprocessor(datum, task_spec, tokenizer, max_seq_length=128, idx=0)  # doctest: +ELLIPSIS
<BLANKLINE>
...
>>> len(processed["message_log_chosen"])
2
>>> processed["message_log_chosen"][0]["content"]
'<|begin_of_text|>What is 2+2?'
>>> processed["message_log_chosen"][-1]["content"]
'4<|eot_id|>'
>>> processed["message_log_rejected"][-1]["content"]
'5<|eot_id|>'
>>>
>>> # context can also contain multiple turns
>>> datum = {
...     "context": [{"role": "user", "content": "I have a question."}, {"role": "assistant", "content": "Sure!"}, {"role": "user", "content": "What is 2+2?"}],
...     "completions": [
...         {"rank": 0, "completion": [{"role": "assistant", "content": "4"}]},
...         {"rank": 1, "completion": [{"role": "assistant", "content": "5"}]}
...     ]
... }
>>> processed = preference_preprocessor(datum, task_spec, tokenizer, max_seq_length=128, idx=0)
>>> len(processed["message_log_chosen"])
4
>>> processed["message_log_chosen"][1]["content"]
'Sure!'
>>> processed["message_log_chosen"][-1]["content"]
'4<|eot_id|>'
>>> processed["message_log_rejected"][-1]["content"]
'5<|eot_id|>'
```

</CodeBlock>


</Indent>

<Anchor id="nemo_rl-data-processors-register_processor">

<CodeBlock links={{"nemo_rl.data.interfaces.TaskDataProcessFnCallable":"/nemo-rl/nemo_rl/data/interfaces#nemo_rl-data-interfaces-TaskDataProcessFnCallable"}} showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.data.processors.register_processor(
    processor_name: str,
    processor_function: nemo_rl.data.interfaces.TaskDataProcessFnCallable
) -> None
```

</CodeBlock>
</Anchor>

<Indent>


</Indent>

<Anchor id="nemo_rl-data-processors-sft_processor">

<CodeBlock links={{"nemo_rl.data.interfaces.TaskDataSpec":"/nemo-rl/nemo_rl/data/interfaces#nemo_rl-data-interfaces-TaskDataSpec","nemo_rl.data.interfaces.DatumSpec":"/nemo-rl/nemo_rl/data/interfaces#nemo_rl-data-interfaces-DatumSpec"}} showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.data.processors.sft_processor(
    datum_dict: dict[str, typing.Any],
    task_data_spec: nemo_rl.data.interfaces.TaskDataSpec,
    tokenizer,
    max_seq_length: int,
    idx: int,
    add_bos: bool = True,
    add_eos: bool = True,
    add_generation_prompt: bool = False
) -> nemo_rl.data.interfaces.DatumSpec
```

</CodeBlock>
</Anchor>

<Indent>

Process a datum dictionary for SFT training.


</Indent>

<Anchor id="nemo_rl-data-processors-vlm_hf_data_processor">

<CodeBlock links={{"nemo_rl.data.interfaces.TaskDataSpec":"/nemo-rl/nemo_rl/data/interfaces#nemo_rl-data-interfaces-TaskDataSpec","nemo_rl.data.interfaces.DatumSpec":"/nemo-rl/nemo_rl/data/interfaces#nemo_rl-data-interfaces-DatumSpec"}} showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.data.processors.vlm_hf_data_processor(
    datum_dict: dict[str, typing.Any],
    task_data_spec: nemo_rl.data.interfaces.TaskDataSpec,
    processor: transformers.AutoProcessor,
    max_seq_length: int,
    idx: int
) -> nemo_rl.data.interfaces.DatumSpec
```

</CodeBlock>
</Anchor>

<Indent>

Process a datum dictionary (directly loaded from response_datasets/&lt;dataset_name&gt;.py) into a DatumSpec for the VLM Environment.


</Indent>

<Anchor id="nemo_rl-data-processors-PROCESSOR_REGISTRY">

<CodeBlock showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.data.processors.PROCESSOR_REGISTRY: Dict[str, TaskDataProcessFnCallable] = cast(Dict[str, TaskDataProcessFnCallable], {'default': math_hf_data_processor, '...
```

</CodeBlock>
</Anchor>


<Anchor id="nemo_rl-data-processors-TokenizerType">

<CodeBlock showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.data.processors.TokenizerType = PreTrainedTokenizerBase
```

</CodeBlock>
</Anchor>

