---
layout: overview
slug: nemo-rl/nemo_rl/models/generation/sglang/sglang_generation
title: nemo_rl.models.generation.sglang.sglang_generation
---

## Module Contents

### Classes

| Name | Description |
|------|-------------|
| [`SGLangGeneration`](#nemo_rl-models-generation-sglang-sglang_generation-SGLangGeneration) | - |

### Data

[`TOP_K_THRESHOLD`](#nemo_rl-models-generation-sglang-sglang_generation-TOP_K_THRESHOLD)

[`TOP_P_THRESHOLD`](#nemo_rl-models-generation-sglang-sglang_generation-TOP_P_THRESHOLD)

[`logger`](#nemo_rl-models-generation-sglang-sglang_generation-logger)

### API

<Anchor id="nemo_rl-models-generation-sglang-sglang_generation-SGLangGeneration">

<CodeBlock links={{"nemo_rl.distributed.virtual_cluster.RayVirtualCluster":"/nemo-rl/nemo_rl/distributed/virtual_cluster#nemo_rl-distributed-virtual_cluster-RayVirtualCluster","nemo_rl.models.generation.sglang.config.SGLangConfig":"/nemo-rl/nemo_rl/models/generation/sglang/config#nemo_rl-models-generation-sglang-config-SGLangConfig"}} showLineNumbers={false} wordWrap={true}>

```python
class nemo_rl.models.generation.sglang.sglang_generation.SGLangGeneration(
    cluster: nemo_rl.distributed.virtual_cluster.RayVirtualCluster,
    config: nemo_rl.models.generation.sglang.config.SGLangConfig,
    name_prefix: str = 'sglang_policy',
    workers_per_node: typing.Optional[typing.Union[int, list[int]]] = None
)
```

</CodeBlock>
</Anchor>

<Indent>

**Bases:** [GenerationInterface](/nemo-rl/nemo_rl/models/generation/interfaces#nemo_rl-models-generation-interfaces-GenerationInterface)

<ParamField path="current_generate_dp_shard_idx" type="= 0">
</ParamField>

<ParamField path="sglang_cfg" type="= config['sglang_cfg']">
</ParamField>

<ParamField path="sharding_annotations">
</ParamField>

<ParamField path="worker_group">
</ParamField>
<Anchor id="nemo_rl-models-generation-sglang-sglang_generation-SGLangGeneration-__del__">

<CodeBlock showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.models.generation.sglang.sglang_generation.SGLangGeneration.__del__() -> None
```

</CodeBlock>
</Anchor>

<Indent>

Shuts down the worker groups when the object is deleted or is garbage collected.

This is an extra safety net in case the user forgets to call shutdown() and the pointer to
the object is lost due to leaving a function scope. It's always recommended that the
user calls shutdown().


</Indent>
<Anchor id="nemo_rl-models-generation-sglang-sglang_generation-SGLangGeneration-_allocate_bundles_for_servers">

<CodeBlock links={{"nemo_rl.distributed.virtual_cluster.RayVirtualCluster":"/nemo-rl/nemo_rl/distributed/virtual_cluster#nemo_rl-distributed-virtual_cluster-RayVirtualCluster"}} showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.models.generation.sglang.sglang_generation.SGLangGeneration._allocate_bundles_for_servers(
    cluster: nemo_rl.distributed.virtual_cluster.RayVirtualCluster,
    num_servers: int,
    gpus_per_server: int
) -> list[tuple[int, list[int]]]
```

</CodeBlock>
</Anchor>

<Indent>

Allocate GPU bundles to each SGLang server.

Each server gets consecutive bundles within the same placement group (node).
Ray will automatically set CUDA_VISIBLE_DEVICES so each server sees logical GPUs 0, 1, 2, ..., gpus_per_server-1.

**Parameters:**

<ParamField path="cluster" type="RayVirtualCluster">
The Ray virtual cluster
</ParamField>

<ParamField path="num_servers" type="int">
Total number of SGLang servers to create
</ParamField>

<ParamField path="gpus_per_server" type="int">
Number of GPUs each server needs
</ParamField>

**Returns:** `list[tuple[int, list[int]]]`

List of (node_idx, [bundle_indices]) tuples for each server


</Indent>
<Anchor id="nemo_rl-models-generation-sglang-sglang_generation-SGLangGeneration-finish_generation">

<CodeBlock showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.models.generation.sglang.sglang_generation.SGLangGeneration.finish_generation(
    args: typing.Any = (),
    kwargs: typing.Any = {}
) -> bool
```

</CodeBlock>
</Anchor>

<Indent>

Sleep workers and reset prefix cache.


</Indent>
<Anchor id="nemo_rl-models-generation-sglang-sglang_generation-SGLangGeneration-generate">

<CodeBlock links={{"nemo_rl.distributed.batched_data_dict.BatchedDataDict":"/nemo-rl/nemo_rl/distributed/batched_data_dict#nemo_rl-distributed-batched_data_dict-BatchedDataDict","nemo_rl.models.generation.interfaces.GenerationDatumSpec":"/nemo-rl/nemo_rl/models/generation/interfaces#nemo_rl-models-generation-interfaces-GenerationDatumSpec","nemo_rl.models.generation.interfaces.GenerationOutputSpec":"/nemo-rl/nemo_rl/models/generation/interfaces#nemo_rl-models-generation-interfaces-GenerationOutputSpec"}} showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.models.generation.sglang.sglang_generation.SGLangGeneration.generate(
    data: nemo_rl.distributed.batched_data_dict.BatchedDataDict[nemo_rl.models.generation.interfaces.GenerationDatumSpec],
    greedy: bool = False
) -> nemo_rl.distributed.batched_data_dict.BatchedDataDict[nemo_rl.models.generation.interfaces.GenerationOutputSpec]
```

</CodeBlock>
</Anchor>

<Indent>

Generate a batch of data using SGLang.


</Indent>
<Anchor id="nemo_rl-models-generation-sglang-sglang_generation-SGLangGeneration-get_sglang_server_urls">

<CodeBlock showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.models.generation.sglang.sglang_generation.SGLangGeneration.get_sglang_server_urls() -> list[str]
```

</CodeBlock>
</Anchor>

<Indent>

Get base URLs of all SGLang servers.

**Returns:** `list[str]`

List of base URLs (e.g., ["http://localhost:30000", "http://localhost:30001"])


</Indent>
<Anchor id="nemo_rl-models-generation-sglang-sglang_generation-SGLangGeneration-get_sglang_url_to_gpu_uuids">

<CodeBlock showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.models.generation.sglang.sglang_generation.SGLangGeneration.get_sglang_url_to_gpu_uuids() -> dict[str, list[str]]
```

</CodeBlock>
</Anchor>

<Indent>

Get mapping from SGLang server URL to list of GPU UUIDs it uses.

**Returns:** `dict[str, list[str]]`

Dict mapping server URL to list of GPU UUIDs


</Indent>
<Anchor id="nemo_rl-models-generation-sglang-sglang_generation-SGLangGeneration-init_collective">

<CodeBlock showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.models.generation.sglang.sglang_generation.SGLangGeneration.init_collective(
    ip: str,
    port: int,
    world_size: int,
    train_world_size: int
) -> list[ray.ObjectRef]
```

</CodeBlock>
</Anchor>

<Indent>

Initialize the collective communication.

TODO:       if weight updates via NCCL are needed in the future.


</Indent>
<Anchor id="nemo_rl-models-generation-sglang-sglang_generation-SGLangGeneration-invalidate_kv_cache">

<CodeBlock showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.models.generation.sglang.sglang_generation.SGLangGeneration.invalidate_kv_cache() -> bool
```

</CodeBlock>
</Anchor>

<Indent>

Invalidate KV cache before weight updates (Megatron-style).

This flushes the cache before weight updates to clear stale cache.
Only primary workers (TP rank 0, model owners) will flush their cache.

**Returns:** `bool`

True if all caches were flushed successfully, False otherwise


</Indent>
<Anchor id="nemo_rl-models-generation-sglang-sglang_generation-SGLangGeneration-prepare_for_generation">

<CodeBlock showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.models.generation.sglang.sglang_generation.SGLangGeneration.prepare_for_generation(
    args: typing.Any = (),
    kwargs: typing.Any = {}
) -> bool
```

</CodeBlock>
</Anchor>

<Indent>

Wake workers up for colocated inference.


</Indent>
<Anchor id="nemo_rl-models-generation-sglang-sglang_generation-SGLangGeneration-prepare_refit_info">

<CodeBlock showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.models.generation.sglang.sglang_generation.SGLangGeneration.prepare_refit_info(
    state_dict_info: dict[str, typing.Any]
) -> None
```

</CodeBlock>
</Anchor>

<Indent>


</Indent>
<Anchor id="nemo_rl-models-generation-sglang-sglang_generation-SGLangGeneration-shutdown">

<CodeBlock showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.models.generation.sglang.sglang_generation.SGLangGeneration.shutdown() -> bool
```

</CodeBlock>
</Anchor>

<Indent>

Shut down all SGLang workers and clean up resources.


</Indent>
<Anchor id="nemo_rl-models-generation-sglang-sglang_generation-SGLangGeneration-update_weights_from_collective">

<CodeBlock showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.models.generation.sglang.sglang_generation.SGLangGeneration.update_weights_from_collective() -> list[ray.ObjectRef]
```

</CodeBlock>
</Anchor>

<Indent>


</Indent>
<Anchor id="nemo_rl-models-generation-sglang-sglang_generation-SGLangGeneration-update_weights_via_ipc_zmq">

<CodeBlock showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.models.generation.sglang.sglang_generation.SGLangGeneration.update_weights_via_ipc_zmq() -> list[ray.ObjectRef]
```

</CodeBlock>
</Anchor>

<Indent>


</Indent>
</Indent>

<Anchor id="nemo_rl-models-generation-sglang-sglang_generation-TOP_K_THRESHOLD">

<CodeBlock showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.models.generation.sglang.sglang_generation.TOP_K_THRESHOLD = 8000
```

</CodeBlock>
</Anchor>


<Anchor id="nemo_rl-models-generation-sglang-sglang_generation-TOP_P_THRESHOLD">

<CodeBlock showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.models.generation.sglang.sglang_generation.TOP_P_THRESHOLD = 0.99
```

</CodeBlock>
</Anchor>


<Anchor id="nemo_rl-models-generation-sglang-sglang_generation-logger">

<CodeBlock showLineNumbers={false} wordWrap={true}>

```python
nemo_rl.models.generation.sglang.sglang_generation.logger = logging.getLogger(__name__)
```

</CodeBlock>
</Anchor>

